$(function(){$.widget("custom.dynamicTreeSearch",{options:{treeRegion:null,delay:200,ajaxId:null,filterOnLoad:"Y"},_privateSorage:function(){var e=this;e._vals={keyTimeout:null,lastVal:"",filterVal:"",item:"",onLoad:"Y"},e._obj={$item:null,$treeList:null,$treeRegion:null}},_init:function(){var e=this;apex.debug.log("APEX Dynamic Tree Search","APEX Init, Tree Region ID = ",e.options.treeRegion),e._privateSorage(),e._obj.$item=$(e.element),e._obj.$treeRegion=$("#"+e.options.treeRegion),e._obj.$treeList=e._obj.$treeRegion.find(".tree ul,.a-TreeView ul"),e._vals.item=e._obj.$item.attr("id"),e._obj.$item.on("change",function(){e._change()}).on("keydown",function(){e._keydown()}),"Y"===e.options.filterOnLoad&&e._obj.$item.val().length>0&&e._obj.$treeList.ready(function(){e._vals.lastVal=e._obj.$item.val(),e._change()})},_filter:function(e,t){var i=this;if(apex.debug.log("APEX Dynamic Tree Search","Filter Loop"),!e.is("ul")&&!e.is("ol"))return!1;for(var a=e.children(),n=!1,o=0;o<a.length;o++){var l=$(a[o]);if(l.is("li")){var r=!1;if(l.children().length>0)for(var s=0;s<l.children().length;s++){var _=i._filter($(l.children()[s]),t);r=r||_}if(!r){var d=l.text();r=d.toLowerCase().indexOf(t)>=0}l.css("display",r?"":"none"),n=n||r}}return n},_keydown:function(){var e=this;apex.debug.log("APEX Dynamic Tree Search","Keydown"),e._vals.onLoad="N",clearTimeout(e._vals.keyTimeout),e._vals.keyTimeout=setTimeout(function(){var t=e._obj.$item.val();t!==e._vals.lastVal&&(e._vals.lastVal=t,e._change())},e.options.delay)},_change:function(){var e=this;apex.debug.log("APEX Dynamic Tree Search","Change"),e._obj.$treeList=e._obj.$treeRegion.find(".tree ul,.a-TreeView ul"),e._vals.filterVal=e._vals.lastVal.toLowerCase(),apex.widget.tree.expand_all(e._obj.$treeRegion.find(".tree,.a-TreeView").attr("id")),e._filter(e._obj.$treeList,e._vals.filterVal),"Y"===e.options.filterOnLoad&&"Y"!=e._vals.onLoad&&apex.server.plugin(e.options.ajaxId,{pageItems:"#"+e._vals.item},{dataType:"text"})}})});